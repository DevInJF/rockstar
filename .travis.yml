language: groovy

jdk:
- oraclejdk7

env:
- GRAILS_VERSION=2.2.4

before_install:
- rm -rf ~/.gvm
- curl -s get.gvmtool.net > ~/install_gvm.sh
- chmod 775 ~/install_gvm.sh
- ~/install_gvm.sh
- echo "gvm_auto_answer=true" > ~/.gvm/etc/config
- source ~/.gvm/bin/gvm-init.sh
- gvm install grails $GRAILS_VERSION || true

script: grails refresh-dependencies && grails clean && grails upgrade --non-interactive && grails war --non-interactive

deploy:
  provider: releases
  secure: "j1ADEDVRKoPlxEqSsZCItfSebPlVuKhK5e5Ov711XIiB37z5DbqDp7phNGl1Vt+EhSF8kMeFylACB78ncj/Y1Tb4KZG34ZKa+krAs60jhvJk3S+ewAlxzdKSyZdd16ZpWtLFseomY71OJ7twFLhgw4xQOK03CEFCea7uDbhyjGQ="
  file: "target/rockstar-1.0.0.war"
  skip_cleanup: true
  on:
    tags: true
    all_branches: true
    repo: IDeaSCo/rockstar
